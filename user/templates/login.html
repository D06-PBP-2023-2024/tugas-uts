{% extends 'base.html' %}

{% block meta %}
    <title>Login</title>
{% endblock meta %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="mb-3 text-center">
                <h1>We help kids be their best selves</h1>
                <div class="container mt-5">
                    <div class="row justify-content-center">
                        <div class="col-md-4">
                            <div class="card mb-4">
                                <div class="card-body">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="currentColor" class="bi bi-suit-heart-fill text-primary" viewBox="0 0 16 16">
                                        <path d="M4 1c2.21 0 4 1.755 4 3.92C8 2.755 9.79 1 12 1s4 1.755 4 3.92c0 3.263-3.234 4.414-7.608 9.608a.513.513 0 0 1-.784 0C3.234 9.334 0 8.183 0 4.92 0 2.755 1.79 1 4 1z"/>
                                    </svg>
                                    <h3 class="card-title">Fall In Love With Reading</h3>
                                    
                                    <p>From reluctant readers to total bookworms, any kid can get excited about books.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card mb-4">
                                <div class="card-body">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="currentColor" class="bi bi-search-heart-fill text-primary" viewBox="0 0 16 16">
                                        <path d="M6.5 13a6.474 6.474 0 0 0 3.845-1.258h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.008 1.008 0 0 0-.115-.1A6.471 6.471 0 0 0 13 6.5 6.502 6.502 0 0 0 6.5 0a6.5 6.5 0 1 0 0 13Zm0-8.518c1.664-1.673 5.825 1.254 0 5.018-5.825-3.764-1.664-6.69 0-5.018Z"/>
                                    </svg>
                                    <h3 class="card-title" >Grow Through Exploration</h3>
                                    <p>They can read about the topics they love and discover new ones, all while learning.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card mb-4">
                                <div class="card-body">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="currentColor" class="bi bi-stars text-primary" viewBox="0 0 16 16">
                                        <path d="M7.657 6.247c.11-.33.576-.33.686 0l.645 1.937a2.89 2.89 0 0 0 1.829 1.828l1.936.645c.33.11.33.576 0 .686l-1.937.645a2.89 2.89 0 0 0-1.828 1.829l-.645 1.936a.361.361 0 0 1-.686 0l-.645-1.937a2.89 2.89 0 0 0-1.828-1.828l-1.937-.645a.361.361 0 0 1 0-.686l1.937-.645a2.89 2.89 0 0 0 1.828-1.828l.645-1.937zM3.794 1.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387A1.734 1.734 0 0 0 4.593 5.69l-.387 1.162a.217.217 0 0 1-.412 0L3.407 5.69A1.734 1.734 0 0 0 2.31 4.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387A1.734 1.734 0 0 0 3.407 2.31l.387-1.162zM10.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732L9.1 2.137a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L10.863.1z"/>
                                    </svg>
                                    <h3 class="card-title">Succeed in Classroom and Beyond</h3>
                                    <p>Our ever-expanding library and enrichment tools boost reading and critical thinking skills.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>                       
                <button type="button" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#exampleModal">Start Reading</button>
            </div>
            <div class="card">
                <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="exampleModalLabel">Hi, Little Bookworms! </h1>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form method="POST" action="" id="form" onsubmit="return false;">
                                    {% csrf_token %}
                                    <div class="mb-3">
                                        <label for="username" class="col-form-label">What's your username?</label>
                                        <input type="text" class="form-control" id="username" name="username" placeholder="Enter your username"></input>
                                    </div>
                                    <div class="mb-3">
                                        <label for="password" class="col-form-label">Sssh tell me your password</label>
                                        <input type="password" class="form-control" id="password" name="password" placeholder="Enter your password"></input>
                                    </div>
                                    <!-- Added Feeling Form -->
                                    <div class="mb-3">
                                        <label for="feeling" class="col-form-label">How's the day treating you?</label>
                                        <select name='feeling' id='feeling' form='form' class='form-control'>
                                            <option value='HA'>Happy</option>
                                            <option value='SA'>Sad</option>
                                            <option value='EX'>Excited</option>
                                            <option value='BO'>Bored</option>
                                            <option value='SC'>Scared</option>
                                        </select>
                                    </div>
                                </form>
                                {% if messages %}
                                    <ul class="mt-3 list-unstyled">
                                        {% for message in messages %}
                                            <li class="text-danger">{{ message }}</li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type='submit' form='form' value='Submit' type='button' class='btn btn-primary' id='button_add' data-bs-dismiss='modal'>Log In</button> 
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card-header bg-primary text-white">
                    <h2 class="text-center">Book Pick Today?</h2>
                </div>
                <div class="card-footer text-center">
                    <h4>{{ book.title }} by {{ book.authors.0.name }}</h4>
                    <form id="filterForm" method="GET" action="{% url 'user:login' %}">
                        <div class="form-group">
                            <label for="download_range">Download Range:</label>
                            <select id="download_range" name="download_range" class="form-control text-center">
                                <option value="0-10000">0-10000</option>
                                <option value="10001-20000">10001-20000</option>
                                <option value="20001-30000">20001-30000</option>
                                <option value="30001-40000">30001-40000</option>
                                <option value="40001-50000">40001-50000</option>
                                <option value="50001-58506">>50000</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-secondary" style="margin-top: 8px;">Filter Books</button>
                    </form>
                </div>
            </div>
        </div>
        <div class="mb-5 text-center" style="margin-top: 20px;">
            <a>Don't have an account yet? <a href="{% url 'user:register' %}" class="btn btn-warning">Join the Fun!</a>
        </div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>
$(document).ready(function(){
    $("#button_add").click(function(){
        $.ajax({
            type: 'POST',
            url: "{% url 'user:login' %}",  
            data: {
                username: $('#username').val(),
                password: $('#password').val(),
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
            },
            success: function(response){
                if(response.success){
                    window.location.href = "{% url 'user:user_info' %}"; 
                } else {
                    alert(response.error); 
                }
            }
        });
    });
    $("#filterForm").on('submit', function(event){
        event.preventDefault(); 

        var selectedRange = $('#download_range').val(); 

        $.ajax({
            type: 'GET',  
            url: $(this).attr('action'),  
            data: $(this).serialize(),  
            success: function(response){
                $('h4').text(response.book.title + ' by ' + response.book.authors[0].name);
                $('#download_range').val(selectedRange);
            }
        });
    });
});


</script>

{% endblock content %}